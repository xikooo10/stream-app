<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QuickPick Stream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    :root {
      --bg-primary: #000000;
      --bg-secondary: #0f0f0f;
      --text-primary: #ffffff;
      --text-secondary: #666666;
      --accent: #b5ff00;
      --border: #1a1a1a;
      --live: #ff0000;
    }
    
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: system-ui, -apple-system, sans-serif;
      overflow: hidden;
      line-height: 1.5;
    }

    #header {
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid var(--border);
      padding: 8px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      max-height: 50vh;
      overflow-y: auto;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .header-controls {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    #current-channel {
      font-size: 12px;
      font-weight: 700;
      color: var(--accent);
    }

    #search-box {
      padding: 6px 10px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 12px;
      width: 160px;
    }

    #search-box:focus {
      outline: none;
      border-color: var(--accent);
    }

    .btn {
      padding: 6px 12px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .filter-tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .filter-tab {
      padding: 4px 10px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .filter-tab:hover {
      color: var(--text-primary);
    }

    .filter-tab.active {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
      font-weight: 600;
    }

    #live-matches-section {
      background: rgba(15, 15, 15, 0.9);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 12px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 8px;
    }

    #live-matches {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 4px;
    }

    .match-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px;
      min-width: 200px;
      max-width: 200px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .match-card:hover,
    .match-card.active {
      border-color: var(--accent);
    }

    .match-time-badge {
      background: var(--live);
      color: #fff;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 700;
      display: inline-block;
      margin-bottom: 6px;
    }

    .match-league {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      text-transform: uppercase;
    }

    .match-teams {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    .team-name {
      font-size: 11px;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .stream-selector {
      width: 100%;
      padding: 4px 8px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 3px;
      color: var(--text-secondary);
      font-size: 10px;
      cursor: pointer;
    }

    .stream-selector:focus {
      outline: none;
      border-color: var(--accent);
    }

    #channels {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 6px;
      max-height: 120px;
      overflow-y: auto;
      padding: 4px;
    }

    .channel-wrapper {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .channel-btn {
      padding: 8px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      transition: all 0.2s;
      width: 100%;
    }

    .channel-btn:hover {
      border-color: var(--accent);
    }

    .channel-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #000;
    }

    .folder-selector {
      width: 100%;
      padding: 3px 6px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 3px;
      color: var(--text-secondary);
      font-size: 9px;
      cursor: pointer;
    }

    .folder-selector:focus {
      outline: none;
      border-color: var(--accent);
    }

    #player-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100vh;
      background: var(--bg-primary);
      z-index: 1;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .overlay-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      display: none;
    }

    #loading.show,
    #error-msg.show {
      display: block;
    }

    .spinner {
      border: 4px solid var(--border);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--accent);
      color: var(--text-primary);
      padding: 10px 16px;
      border-radius: 6px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
    }

    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body>

<div id="app">
  <header id="header">
    <div class="header-top">
      <div class="header-controls">
        <input 
          type="search" 
          id="search-box" 
          placeholder="Search..."
        >
        <button id="refresh-btn" class="btn">üîÑ</button>
        <button id="logout-btn" class="btn">Logout</button>
      </div>
    </div>

    <div id="current-channel">Select a channel</div>

    <div id="live-matches-section">
      <div class="section-title">
        üî¥ LIVE MATCHES
        <button id="refresh-matches-btn" class="btn" style="padding: 3px 8px; font-size: 10px; float: right;">üîÑ</button>
      </div>
      <div id="live-matches">
        <div class="loading-matches" style="text-align: center; padding: 20px; color: var(--text-secondary);">
          <div class="spinner" style="width: 35px; height: 35px; margin: 8px auto;"></div>
          Loading...
        </div>
      </div>
    </div>

    <div style="border-top: 1px solid var(--border); margin: 8px 0;"></div>

    <div style="font-size: 12px; font-weight: 700; margin-bottom: 6px;">üì∫ CHANNELS</div>

    <div class="filter-tabs">
      <button class="filter-tab active" data-filter="all">All</button>
      <button class="filter-tab" data-filter="sport">Sport TV</button>
      <button class="filter-tab" data-filter="dazn">DAZN</button>
    </div>

    <div id="channels"></div>
  </header>

  <main id="player-container">
    <div id="loading" class="overlay-message">
      <div class="spinner"></div>
      <div>Loading...</div>
    </div>
    <div id="error-msg" class="overlay-message">
      <p style="font-size: 40px;">‚ö†Ô∏è</p>
      <p>Stream unavailable</p>
    </div>
    <iframe id="player" allowfullscreen allow="autoplay; fullscreen"></iframe>
  </main>
</div>

<div id="toast" class="toast"></div>

<script>
'use strict';

const CONFIG = {
  STREAM_BASE: 'https://dlhd.link',
  API_BASE: 'https://api.watchfooty.st/api/v1',
  REFRESH_INTERVAL: 15000
};

const channels = [
  { name: "SPORT TV1", id: 49, category: "sport" },
  { name: "SPORT TV2", id: 74, category: "sport" },
  { name: "SPORT TV3", id: 454, category: "sport" },
  { name: "SPORT TV4", id: 289, category: "sport" },
  { name: "SPORT TV5", id: 290, category: "sport" },
  { name: "SPORT TV6", id: 291, category: "sport" },
  { name: "DAZN 1", id: 455, category: "dazn" },
  { name: "DAZN 2", id: 456, category: "dazn" },
  { name: "DAZN 3", id: 457, category: "dazn" },
  { name: "DAZN 4", id: 458, category: "dazn" },
  { name: "DAZN 5", id: 459, category: "dazn" },
  { name: "BTV", id: 380, category: "other" }
];

const folders = ["stream", "watch", "player", "cast"];

const state = {
  currentButton: null,
  currentCard: null,
  currentFilter: 'all',
  matches: [],
  refreshTimer: null
};

const el = {
  channels: document.getElementById("channels"),
  search: document.getElementById("search-box"),
  current: document.getElementById("current-channel"),
  player: document.getElementById("player"),
  loading: document.getElementById("loading"),
  error: document.getElementById("error-msg"),
  toast: document.getElementById("toast"),
  matches: document.getElementById("live-matches"),
  refreshMatches: document.getElementById("refresh-matches-btn"),
  refresh: document.getElementById("refresh-btn"),
  logout: document.getElementById("logout-btn")
};

function showToast(msg) {
  el.toast.textContent = msg;
  el.toast.classList.add("show");
  setTimeout(() => el.toast.classList.remove("show"), 2000);
}

function getStreamUrl(id, folder) {
  return `${CONFIG.STREAM_BASE}/${folder}/stream-${id}.php`;
}

function showLoading() {
  el.loading.classList.add("show");
  el.error.classList.remove("show");
}

function hideLoading() {
  el.loading.classList.remove("show");
}

function playChannel(id, wrapper, name) {
  showLoading();
  
  if (state.currentButton) state.currentButton.classList.remove("active");
  if (state.currentCard) state.currentCard.classList.remove("active");
  
  const btn = wrapper.querySelector('.channel-btn');
  state.currentButton = btn;
  btn.classList.add("active");
  
  el.current.textContent = name;
  
  const selector = wrapper.querySelector("select");
  const folder = selector ? selector.value : folders[0];
  
  el.player.src = getStreamUrl(id, folder);
  showToast(`Playing: ${name}`);
}

function playMatch(match, streamIndex = 0) {
  showLoading();
  
  if (state.currentButton) state.currentButton.classList.remove("active");
  if (state.currentCard) state.currentCard.classList.remove("active");
  
  const card = document.querySelector(`[data-match-id="${match.matchId}"]`);
  if (card) {
    state.currentCard = card;
    card.classList.add("active");
  }
  
  const title = `${match.teams.home.name} vs ${match.teams.away.name}`;
  el.current.textContent = title;
  
  if (match.streams && match.streams[streamIndex]) {
    el.player.src = match.streams[streamIndex].url;
    showToast(`Watching: ${title}`);
  }
}

function renderChannels(filter = 'all', search = '') {
  let filtered = [...channels];
  
  if (filter !== 'all') {
    filtered = filtered.filter(ch => ch.category === filter);
  }
  
  if (search) {
    const term = search.toLowerCase();
    filtered = filtered.filter(ch => ch.name.toLowerCase().includes(term));
  }
  
  el.channels.innerHTML = '';
  
  filtered.forEach(ch => {
    const wrapper = document.createElement("div");
    wrapper.className = "channel-wrapper";
    wrapper.dataset.channelId = ch.id;
    
    const btn = document.createElement("button");
    btn.className = "channel-btn";
    btn.textContent = ch.name;
    btn.onclick = () => playChannel(ch.id, wrapper, ch.name);
    
    const selector = document.createElement("select");
    selector.className = "folder-selector";
    folders.forEach(f => {
      const opt = document.createElement("option");
      opt.value = f;
      opt.textContent = f;
      selector.appendChild(opt);
    });
    
    wrapper.appendChild(btn);
    wrapper.appendChild(selector);
    el.channels.appendChild(wrapper);
  });
}

function createMatchCard(match) {
  const card = document.createElement('div');
  card.className = 'match-card';
  card.dataset.matchId = match.matchId;
  
  const hdStreams = match.streams ? match.streams.filter(s => {
    const q = (s.quality || '').toLowerCase();
    const l = (s.language || '').toLowerCase();
    const isHD = q.includes('hd') || q === 'high' || q === '';
    const isLang = l.includes('en') || l.includes('pt') || l.includes('por');
    return isHD && isLang;
  }) : [];
  
  let streamsHTML = '';
  if (hdStreams.length > 0) {
    streamsHTML = `
      <select class="stream-selector" data-match-id="${match.matchId}">
        ${hdStreams.map((s, i) => {
          const idx = match.streams.indexOf(s);
          return `<option value="${idx}">${s.quality || 'HD'} - ${s.language || 'EN'}</option>`;
        }).join('')}
      </select>
    `;
  } else {
    streamsHTML = '<div style="font-size: 10px; color: var(--text-secondary); text-align: center;">No streams</div>';
  }
  
  card.innerHTML = `
    <div class="match-time-badge">LIVE</div>
    <div class="match-league">${match.league}</div>
    <div class="match-teams">
      <div class="team-name">${match.teams.home.name}</div>
      <div class="team-name">${match.teams.away.name}</div>
    </div>
    ${streamsHTML}
  `;
  
  if (hdStreams.length > 0) {
    card.addEventListener('click', (e) => {
      if (e.target.classList.contains('stream-selector')) return;
      const selector = card.querySelector('.stream-selector');
      const idx = selector ? parseInt(selector.value) : match.streams.indexOf(hdStreams[0]);
      playMatch(match, idx);
    });
    
    const selector = card.querySelector('.stream-selector');
    if (selector) {
      selector.addEventListener('change', (e) => {
        e.stopPropagation();
        playMatch(match, parseInt(e.target.value));
      });
    }
  }
  
  return card;
}

async function fetchMatches() {
  try {
    const url = `${CONFIG.API_BASE}/matches/football/popular/live?_t=${Date.now()}`;
    const res = await fetch(url, {
      headers: { 'Cache-Control': 'no-cache' }
    });
    
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    
    const data = await res.json();
    state.matches = data;
    
    el.matches.innerHTML = '';
    
    if (data.length === 0) {
      el.matches.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No live matches</div>';
      return;
    }
    
    data.forEach(match => {
      el.matches.appendChild(createMatchCard(match));
    });
  } catch (err) {
    console.error('Error fetching matches:', err);
    el.matches.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Error loading matches</div>';
  }
}

function startAutoRefresh() {
  if (state.refreshTimer) clearInterval(state.refreshTimer);
  state.refreshTimer = setInterval(fetchMatches, CONFIG.REFRESH_INTERVAL);
}

// Event listeners
document.querySelectorAll('.filter-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
    state.currentFilter = this.dataset.filter;
    renderChannels(state.currentFilter, el.search.value);
  });
});

el.search.addEventListener("input", (e) => {
  renderChannels(state.currentFilter, e.target.value);
});

el.refresh.addEventListener("click", () => {
  if (el.player.src) {
    showLoading();
    const src = el.player.src;
    el.player.src = "";
    setTimeout(() => el.player.src = src, 100);
    showToast("Refreshing...");
  }
});

el.refreshMatches.addEventListener("click", () => {
  showToast("Refreshing matches...");
  fetchMatches();
});

el.logout.addEventListener("click", () => {
  if (confirm("Logout?")) {
    document.cookie = "auth_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    window.location.href = "/";
  }
});

el.player.addEventListener("load", hideLoading);

// Initialize
renderChannels();
fetchMatches();
startAutoRefresh();

// Cleanup
window.addEventListener('beforeunload', () => {
  if (state.refreshTimer) clearInterval(state.refreshTimer);
});
</script>

</body>
</html>
